---
import { neon } from '@neondatabase/serverless';

// Configura la conexi√≥n a la base de datos Neon
const sql = neon(
    "postgresql://Programs-db_owner:gt7QxJLNI4rP@ep-shrill-brook-a5j8odhx.us-east-2.aws.neon.tech/Programs-db?sslmode=require"
  );


  if (Astro.request.method === 'POST') {
  // Analizar datos de formulario
  const formData = await Astro.request.formData();
  const author = formData.get('author');
  const content = formData.get('content');
  if (typeof author === 'string' && typeof content === 'string') {
    // Insertar datos de formulario en un Comment
    try {
        const response = await sql`
                INSERT INTO programas (nombre, link_de_imagen, link_de_descarga, detalles)
                VALUES (${author}, ${content}, ${content}, ${author})  
                RETURNING *`;

        console.log("Programa guardado:", response);
      } catch (error) {
        console.error("Error al guardar el programa:", error);
      }
  }}
---

<main>
  <form method="POST" style="display: grid" enctype="multipart/form-data">
    <label for="author">Autor</label>
    <input id="author" name="author" />
  
    <textarea name="content"></textarea>
  
    <button type="submit">Enviar</button>
  </form>
  </main>